@model LYSApp.Model.UserViewModel

    @**---Modal for Image Cropping---*@
    <div id="divCropResizeImage" class="modal fade col-lg-12 col-md-12 col-sm-12 col-xs-12" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content  bounceInRight">
                <div class="modal-header">
                    <button type="button" id="btnCropClose" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Crop Image</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-4">
                            <img id="demo3" alt="Jcrop Example" />
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <input class="btn btn-primary" id="btnSkipCropping" type="submit" aria-hidden="true" value="Skip Cropping" />
                    <input class="btn btn-primary" id="btnCrop" type="submit" value="Crop" />
                </div>
            </div>
        </div>
    </div>

@using (Ajax.BeginForm("UpdateProfilePicture", "User", new AjaxOptions { UpdateTargetId = "tab-3" }))
{
<div id="tab-3" class="tab-pane">
    <div class="row form-group">
        <div class="col-md-12">
            <div class="form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div id="divFile" class="col-lg-8 col-md-8 col-sm-12 col-xs-12 row-padding-top-5">
                    
                    <label for="fileProfile" id="fileLabel">
                        <input class="txtFile" id="fileProfile" name="fileProfile" type="file" style="display:none">
                        <a>Choose File</a>
                    </label>
                    <div><div id="photoFilePath" class="filePath pull-left">No File Chosen</div><span id="spnRemove" onclick="fnRemove()" style="cursor:pointer; color:gray; display:none">x</span></div>
                    <br />
                    <img draggable="false" id="imgProfile" style="display:inline-block; height:250px; width:250px; margin: 0 5px 0 10px;" src=@Model.ProfilePicture alt="" />
                    <div class="row row-padding-top-5">
                        <input type="submit" class="btn btn-green" value="Submit" id="tnSubmitProfilePicture" />
                    </div>
                    @Html.HiddenFor(model => model.ProfilePicture)@*model.ProfilePicture is not updating*@
                    @Html.HiddenFor(model => model.UserID)
                </div>
            </div>
            <div id="divErrorFileFormatIMG" style="display:none" class="form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12">
                </div>
                <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                    <span id="spnErrorFileFormatIMG" class="error" style="display:none;color:red;"></span>
                </div>
            </div>
           
        </div>
        <input type="hidden" id="hdnImageCropWidth" name="ImageCropWidth" />
        <input type="hidden" id="hdnImageCropHeight" name="ImageCropHeight" />
        <input type="hidden" id="hdnCropPointX" name="CropPointX" />
        <input type="hidden" id="hdnCropPointY" name="CropPointY" />
        <input type="hidden" id="hdnCropPointX2" name="CropPointX2" />
        <input type="hidden" id="hdnCropPointY2" name="CropPointY2" />
        <input type="hidden" id="hdnFileName" name="ImgFileName" />
        <input type="hidden" id="hdnImageSource" name="ImageSource" />
    </div>
</div>
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    <script src='@Url.Content("~/Scripts/Custom/User/jquery.Jcrop.min.js")'></script>
    <script src='@Url.Content("~/Scripts/Custom/User/form-image-crop.js")'></script>

   
        <script>
            var CropImageUrl = '@Url.Action("CropImage","User")'
            $(document).ready(function () {

                $(".jcrop-holder").find("div").eq(0).addClass("formatDiv");

                $("#fileProfile").change(function (e) {
                    var file = $(this).val();
                    var ext = file.split('.').pop();
                    if (ext.toLowerCase() == "gif" || ext.toLowerCase() == "jpeg" || ext.toLowerCase() == "jpg" || ext.toLowerCase() == "png") {
                        readURL(this);
                        $('#spnRemove').show();
                    }
                    else {
                        fnDismissModal();
                    }
                });
            });

            document.getElementById("fileProfile").onchange = function () {

                $("#photoFilePath").html(this.value.split('\\').pop());
                $("#photoFilePath").attr("title", this.value.split('\\').pop());
                $("#hdnFileName").val('@Model.UserID' + '_' + this.value.split('\\').pop());

            };


            function fnRemove() {
                $('#fileProfile').val("");
                $('#spnRemove').hide();
                $("#photoFilePath").html("No File Chosen");//
            }

            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {

                        $("#divCropResizeImage").modal('show');
                        $("#hdnImageSource").val(e.target.result);
                        $('.jcrop-holder').replaceWith('');
                        $("#divCropResizeImage .modal-body").empty();
                        $("#divCropResizeImage .modal-body").append("<div class=\"row\" style=\"margin:5%;\">  <div class=\"col-lg-4\"><img id=\"demo3\" alt=\"Jcrop Example\" /></div>");
                        $("#divCropResizeImage .modal-body").append("</div></div></div></div>");
                        $('#demo3').replaceWith('<img id="demo3" src="' + e.target.result + '"/>');
                        FormImageCrop.init();

                        $("#imgPreview").attr("src", e.target.result);
                        $("div.jcrop-holder img").attr("src", e.target.result);

                    }
                    reader.readAsDataURL(input.files[0]);
                }
            }

            function fnLoadImage() {
                $("#hdnIsImageCropped").val("1");
                var imageCropWidth = $("#hdnImageCropWidth").val();
                var imageCropHeight = $("#hdnImageCropHeight").val();
                var cropPointX = $("#hdnCropPointX").val();
                var cropPointY = $("#hdnCropPointY").val();

                if (imageCropWidth == 0 && imageCropHeight == 0) {
                    alert("Please select crop area.");
                    return;
                }
                alert($("#hdnFileName").val());
                $.ajax({
                    url: 'CropImage',
                    type: 'POST',
                    data: {
                        imagePath: $("#demo3").attr("src"),
                        cropPointX: cropPointX,
                        cropPointY: cropPointY,
                        imageCropWidth: imageCropWidth,
                        imageCropHeight: imageCropHeight,
                        fileName: $("#hdnFileName").val()
                    },
                    success: function (data) {
                        $("#divCropResizeImage").modal('hide');
                        $("#fileProfile").files = data.PhotoPath;
                        $("#imgProfile").attr("src", data.PhotoPath);
                        $('#hdnFileName').val(data.filename);
                        $('#profilePic').val(data.PhotoPath);
                        //document.getElementById("profile").src = data.PhotoPath;
                    },
                    error: function (data) { }
                });
            }



            function fnDismissModal() {
                $('#divCropResizeImage').modal('hide');
                $("#hdnIsImageCropped").val("0");
                $("#imgProfile").attr("src", $("#hdnImageSource").val());
                $("#divCropResizeImage .modal-body").empty();
                $("#divCropResizeImage .modal-body").append("<div class=\"row\"><div class=\"col-md-6\"><img id=\"demo3\" max-width=\"500px\" max-height=\"500px\" alt=\"Jcrop Example\" style=\"width: 100%\" /></div>");
                $("#divCropResizeImage .modal-body").append("<div class=\"col-md-6\"><div id=\"preview-pane\"><div class=\"preview-container\"><img id=\"imgPreview\" max-width=\"500px\" max-height=\"500px\" class=\"jcrop-preview\" alt=\"Preview\" />");
                $("#divCropResizeImage .modal-body").append("</div></div></div></div>");
            }

            $('#btnCroplose').click(function () {
                fnLoadImage();
            });

            $('#btnSkipCropping').click(function () {
                fnLoadImage();
            });

            $('#btnCrop').click(function () {
                fnLoadImage();
            });
        </script>
    }



